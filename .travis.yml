sudo: false
language: rust

# run builds for all the trains (and more)
rust:
  - 1.13.0
  - stable
  - beta
  - nightly

matrix:
  include:
    - rust: nightly
      env: CLIPPY=true

before_script:
  - pip install 'travis-cargo<0.2' --user
  - export PATH=$HOME/.local/bin:$PATH

script:
  - (cd serde && travis-cargo build)
  - (cd serde && travis-cargo --only beta test)
  - (cd serde && travis-cargo --only nightly test -- --features unstable-testing)
  - (cd serde && travis-cargo build -- --no-default-features)
  - (cd serde && travis-cargo --only nightly build -- --no-default-features --features alloc)
  - (cd serde && travis-cargo --only nightly build -- --no-default-features --features collections)
  - (cd test_suite && travis-cargo --only beta test)
  - (cd test_suite/deps && travis-cargo --only nightly build && cd .. && travis-cargo --only nightly test -- --features unstable-testing)
  - (cd test_suite/no_std && travis-cargo --only nightly build)
  - sh clippy.sh

env:
  global:
    - TRAVIS_CARGO_NIGHTLY_FEATURE=""
